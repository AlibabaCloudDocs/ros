# 使用云效流水线自动创建资源栈

您可以通过云效流水线，使用ROS模块自动创建资源栈。本文以更新一个包含专有网络的ECS为例，为您介绍使用云效流水线自动创建、更新资源栈的方法。

-   您需要创建服务角色，并对角色进行授权。
    -   请确保您已创建服务角色（例如：TestTeamRole），详情请参见[创建可信实体为阿里云服务的RAM角色](/cn.zh-CN/角色管理/创建RAM角色/创建可信实体为阿里云服务的RAM角色.md)。
    -   请确保您已为角色进行授权，详情请参见[为RAM角色授权](/cn.zh-CN/角色管理/为RAM角色授权.md)。权限详情如下表所示。

        |权限策略名称|权限说明|
        |------|----|
        |AliyunTeambitionRolePolicy|管理云效|
        |AliyunROSFullAccess|管理ROS|
        |AliyunECSFullAccess|管理ECS|
        |AliyunVPCFullAccess|管理VPC|
        |AliyunRDSFullAccess|管理RDS|

-   请确保您已准备代码仓库作为流水线的触发源，例如Git仓库。

云效是企业级一站式DevOps解决方案，提供从“需求 -\>开发-\>测试-\>发布-\>运维-\>运营”端到端的协同服务和研发工具。云效集成了ROS，您可以通过云效调用代码仓库中的ROS模板自动创建、更新资源栈。云效流水线详情，请参见[云效流水线](https://thoughts.aliyun.com/sharespace/5e86a419546fd9001aee81f2/docs/5e86a414546fd9001aee8195)。

例如：您创建、更新资源栈时，每个操作都需要手动与ROS进行交互。而使用云效创建流水线，您可以建立一个发布流程，实现上述多个操作的自动化。

本示例通过将**ECS和RDS创建WordPress环境模板**代码上传至代码仓库，使用云效创建流水线调用该代码，实现为WordPress站点自动创建、更新资源栈。

## 步骤1：将模板代码上传到代码仓库

1.  登录[资源编排控制台](http://ros.console.aliyun.com)。

2.  在左侧导航栏，单击**模板** \> **模板示例**。

3.  在文本框输入WordPress搜索示例模板**基于ECS和RDS创建WordPress环境**，单击**查看详情**。

    ![模板代码](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0256119951/p127860.png)

4.  将模板代码上传到代码仓库。


## 步骤2：通过创建流水线自动创建资源栈

1.  登录[云效](https://flow.aliyun.com/my)。

2.  单击右上角**新建流水线**。

    ![1](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0256119951/p128455.png)

3.  在左侧导航栏单击**其他**，选择**空模板**，单击**创建**。

    ![流水线](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0256119951/p127901.png)

4.  在弹出的添加流水线源对话框中选择代码源，单击**添加**。

    ![流水线5](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0256119951/p127906.png)

5.  单击**空任务**，在弹出的编辑对话框中输入任务名称，单击**添加步骤** \> **发布** \> **ROS发布**。

    ![ROS发布](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0256119951/p139299.png)

6.  设置**选择授权**、**阿里云Region**、**ROS扮演角色**、**Stack名称**、**Stack文件路径**、**超时时间**，单击右上角**仅保存**。

    **说明：** 首次创建流水线时，单击**保存并运行**，在弹出的确认运行流水线对话框中单击**确定**，流水线将自动创建资源栈。

7.  单击**新的任务**，在弹出的选择任务组对话框中，单击左侧导航栏的**工具**。

8.  在**工具**区域，单击**人工卡点**。

9.  在弹出的编辑对话框中，设置**任务名称**、**验证者类型**和**验证人**。

10. 单击**保存并运行**，在弹出的确认运行流水线对话框中单击**确定**，流水线将自动创建资源栈。

    您可以登录资源编排控制台，单击**资源栈**，在资源栈列表页面查看已创建的资源栈信息。

    在进入下一步任务之前，流水线有审批环节。

    -   如果审批通过，您可以执行流水线的下一步任务。
    -   如果审批不通过，您可以修改模板或配置文件，重新执行流水线，再次提交审批。

## 步骤3：更新资源栈

如果您更新了模板，并将新模板代码上传至代码仓库。使用云效流水线调用代码时，资源栈将自动更新。

